%% Sectioning

\newcounter{Rvolumestart}
\newcounter{Rchapterstart}

\newcounter{Rvolume}
\newcounter{Rchapter}
\newcounter{Rsection}
\newcounter{Rsubsect}
\newcommand{\Rcurrentvolume}{\UNDEF}
\newcommand{\Rcurrentchapter}{\UNDEF}
\newcommand{\Rcurrentsection}{\UNDEF}
\newcommand{\Rcurrentsubsect}{\UNDEF}
\renewcommand{\theRvolume}{\Roman{Rvolume}}
\renewcommand{\theRchapter}{\arabic{Rchapter}}

% toc file streams
\newwrite\Rmajortocfile
\newwrite\Rminortocfile
\immediate\openout\Rmajortocfile=RSkylInternal/MajorContents.new
\immediate\write\Rmajortocfile{%
    \noexpand\newcommand{\noexpand\Rmajortocincluded}{true}
}
%\immediate\closeout\Rmajortocfile

\newcommand{\Rtitlepage}[4]{%
    \thispagestyle{empty}
  \vspace*{\fill}
    ~
  \vspace*{\fill}
    \begin{center}
        {\large\textbf{#1}}\\
        \rule[1ex]{\textwidth}{1pt}\\
        {\Huge\textbf{#2}}\\
        \rule[1ex]{\textwidth}{1pt}\\
        {\large\textbf{#3}}
    \end{center}
  \vspace*{\fill}
        #4
  \vspace*{\fill}
    ~
  \vspace*{\fill}
    ~
  \vspace*{\fill}
    \newpage
}

\newcommand{\Rmajortoc}{%
    \noindent\textbf{Table of Contents}\\[1ex]
    \rule[1ex]{\textwidth}{1pt}\\[1em]
    \input{RSkylInternal/MajorContents.tex}
    \lstinputlisting{RSkylInternal/MajorContents.tex}
    \ifdefined\Rmajortocincluded
    \else
        \TODO{Major ToC (rebuild required)}
    \fi
}

\newcommand{\Rtocline}[5]{%
    \noindent
    \parbox[t]{#1}{%
        \hfill
        #2
        \hspace*{2pt}
    }
    \hyperlink{#5}{\textbf{#3}}
    \phantom{\rule[-0.5em]{0pt}{0.5em}}
    \hfill
    #4
    \hspace*{1cm}\\
}

\newcommand{\Rsectinfo}{%
    \arabic{Rvolume}:%
    \arabic{Rchapter}:%
    \arabic{Rsection}:%
    \arabic{Rsubsect}%
}

\newcommand{\Rvolume}[1]{%
    \refstepcounter{Rvolume}
    \setcounter{Rvolumestart}{\value{page}}
    \renewcommand{\Rcurrentvolume}{#1}
    \immediate\write\Rmajortocfile{%
        \noexpand\Rtocline{1cm}%
        {\Roman{Rvolume}.}%
        {#1}%
        {\arabic{page}}%
        {RSkyl:V:\Rsectinfo}
    }
    %
    \setcounter{Rchapter}{0}
    \setcounter{Rsection}{0}
    \setcounter{Rsubsect}{0}
    %
    \thispagestyle{empty}
    ~\vspace{1in}
    \begin{center}
        \hypertarget{RSkyl:V:\Rsectinfo}%
        {\large\textbf{Volume \Roman{Rvolume}}}\\
        \rule[1ex]{0.75\textwidth}{1pt}\\
        {\huge\textbf{#1}}
    \end{center}
}

\newcommand{\Rchapter}[1]{%
    \refstepcounter{Rchapter}
    \setcounter{Rchapterstart}{\value{page}}
    \renewcommand{\Rcurrentchapter}{#1}
    \immediate\write\Rmajortocfile{%
        \noexpand\Rtocline{1.5cm}%
        {\arabic{Rchapter}}%
        {#1}%
        {\arabic{page}}%
        {RSkyl:C:\Rsectinfo}
    }
    %
    \setcounter{Rsection}{0}
    \setcounter{Rsubsect}{0}
    %
    \thispagestyle{empty}
    ~\vspace{1cm}
    \begin{center}
        \hypertarget{RSkyl:C:\Rsectinfo}%
        {\textbf{Chapter \arabic{Rchapter}}}\\
        \rule[1ex]{0.5\textwidth}{1pt}\\
        {\Large\textbf{#1}}
    \end{center}
}

%% End
